<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painted Valentine</title>

  <style>
    :root{
      --cream: #f7f1e6;
      --ink: #1a1a1a;
      --shadow: 0 20px 60px rgba(0,0,0,.28);
      --shadowSoft: 0 14px 38px rgba(0,0,0,.18);
      --pink: #ff6fb3; /* lighter pink */
      --glass: rgba(255,255,255,.10);
      --glass2: rgba(255,255,255,.18);
      --stroke: rgba(255,255,255,.25);
      --ui: rgba(18,18,18,.55);
    }

    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      background: #0b0b0b;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: white;
    }

    /* BACKGROUND STACK */
    .stage {
      position: fixed;
      inset: 0;
      overflow: hidden;
    }

    .bg {
      position: absolute;
      inset: -6%;
      background-size: cover;
      background-position: center;
      transform: scale(1.04);
      filter: saturate(1.05) contrast(1.05);
      transition: opacity 800ms ease, filter 800ms ease;
      opacity: 1;
    }

    /* Cloud layer (transparent PNG) */
    .clouds {
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: .30;
      mix-blend-mode: screen;
    }
    .cloud {
      position: absolute;
      top: 8%;
      left: -40%;
      width: min(1100px, 140vw);
      height: auto;
      filter: blur(0.4px);
      opacity: .85;
      animation: cloudDrift 70s ease-in-out infinite alternate;
    }
    .cloud.two {
      top: 16%;
      left: -55%;
      width: min(900px, 120vw);
      opacity: .55;
      animation-duration: 92s;
      animation-delay: -14s;
    }

    /* This is the ‚Äútinted glass‚Äù over the painting BEFORE YES */
    .tintGlass {
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 1;
      transition: opacity 900ms ease;
      background:
        radial-gradient(1200px 900px at 50% 40%, rgba(255,255,255,.10), rgba(0,0,0,.35)),
        linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.35));
      backdrop-filter: blur(3px);
    }

    /* Slight ‚Äúmuseum glass‚Äù specular sweep */
    .tintGlass::after{
      content:"";
      position:absolute;
      inset:-40%;
      background: linear-gradient(110deg,
        transparent 0%,
        rgba(255,255,255,.05) 35%,
        rgba(255,255,255,.12) 46%,
        rgba(255,255,255,.04) 58%,
        transparent 70%);
      transform: translateX(-25%) rotate(1deg);
      animation: sweep 14s ease-in-out infinite;
      opacity: .9;
    }

    @keyframes sweep {
      0%   { transform: translateX(-25%) rotate(1deg); opacity:.65; }
      50%  { transform: translateX(12%) rotate(1deg);  opacity:.85; }
      100% { transform: translateX(-25%) rotate(1deg); opacity:.65; }
    }

    @keyframes cloudDrift {
      0%   { transform: translateX(0px) translateY(0px); }
      100% { transform: translateX(520px) translateY(14px); }
    }

    /* FOREGROUND UI LAYER */
    .ui {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 24px;
    }

    /* NOTE CARD */
    .noteWrap{
      width: min(720px, 92vw);
      position: relative;
      z-index: 5;
    }

    .note {
      background: var(--cream);
      color: #231f1a;
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 34px 34px 26px;
      position: relative;
      overflow: hidden;
      transition: transform 600ms ease, filter 600ms ease, opacity 600ms ease;
    }

    /* Paper texture */
    .note::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(900px 600px at 20% 20%, rgba(255,255,255,.55), transparent 60%),
        radial-gradient(900px 700px at 90% 40%, rgba(0,0,0,.05), transparent 60%),
        repeating-linear-gradient(0deg, rgba(0,0,0,.015) 0, rgba(0,0,0,.015) 1px, transparent 2px, transparent 6px);
      opacity: .55;
      pointer-events:none;
    }

    .noteInner{
      position: relative;
      z-index: 1;
      line-height: 1.45;
      font-size: clamp(16px, 2.1vw, 19px);
    }

    .note h1{
      margin: 0 0 14px;
      font-weight: 700;
      font-size: clamp(18px, 2.4vw, 22px);
      letter-spacing: .2px;
    }

    .note p{ margin: 10px 0; }

    .sig{
      margin-top: 16px;
      font-weight: 650;
    }
    .sig small{
      display:block;
      font-weight: 600;
      opacity: .72;
      margin-top: 2px;
    }

    /* Center italic line that fades away */
    .centerWhisper {
      position: fixed;
      left: 50%;
      top: 18%;
      transform: translateX(-50%);
      z-index: 6;
      font-style: italic;
      letter-spacing: .2px;
      color: rgba(255,255,255,.92);
      text-shadow: 0 12px 36px rgba(0,0,0,.35);
      opacity: 0;
      pointer-events: none;
      transition: opacity 900ms ease;
      text-align:center;
      padding: 0 14px;
      width: min(820px, 92vw);
      font-size: clamp(16px, 2.3vw, 22px);
    }

    /* Buttons */
    .row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 18px;
      flex-wrap: wrap;
    }

    .btn {
      appearance: none;
      border: none;
      border-radius: 999px;
      padding: 12px 18px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 10px 26px rgba(0,0,0,.18);
      transition: transform 120ms ease, filter 120ms ease;
      user-select: none;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }

    .btnYes{
      background: #1f1f1f;
      color: #fff;
    }
    .btnNo{
      background: rgba(255,255,255,.8);
      color: #111;
      border: 1px solid rgba(0,0,0,.08);
    }
    .btnEnter{
      background: var(--pink);
      color: #1b0b12;
    }
    .btnReset{
      background: rgba(255,255,255,.9);
      color: #111;
      border: 1px solid rgba(0,0,0,.08);
      padding: 10px 14px;
    }

    /* "No" state (paper turns dark) */
    .note.nope{
      background: #0d0d0f;
      color: rgba(255,255,255,.92);
      filter: saturate(.9);
    }
    .note.nope::before{
      opacity: .25;
      filter: contrast(1.2);
    }
    .noLine{
      margin-top: 12px;
      font-weight: 800;
    }

    /* PLAYER */
    .player {
      position: fixed;
      left: 18px;
      bottom: 18px;
      width: min(420px, 92vw);
      z-index: 8;
      background: rgba(10,10,10,.42);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      box-shadow: var(--shadowSoft);
      backdrop-filter: blur(10px);
      padding: 14px 14px 12px;
      display: none; /* hidden until they enter */
    }

    .playerTop{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    .trackTitle{
      font-weight: 800;
      letter-spacing: .2px;
      font-size: 15px;
      line-height: 1.1;
      color: rgba(255,255,255,.92);
      overflow: hidden;
      white-space: nowrap;
      width: 100%;
      position: relative;
    }

    /* Marquee effect container */
    .marquee{
      display:inline-block;
      padding-left: 0;
      will-change: transform;
    }
    .marquee.run{
      animation: marquee 12s linear infinite;
    }
    @keyframes marquee{
      0%{ transform: translateX(0%); }
      100%{ transform: translateX(-55%); }
    }

    .modes {
      display:flex;
      gap: 8px;
      align-items:center;
    }

    .chip{
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.9);
      cursor: pointer;
      display:grid;
      place-items:center;
      user-select:none;
      transition: transform 120ms ease, background 120ms ease;
      font-size: 14px;
    }
    .chip:active{ transform: scale(.98); }
    .chip.on{
      background: rgba(255,255,255,.18);
      border-color: rgba(255,255,255,.24);
    }

    .progressRow{
      display:flex;
      align-items:center;
      gap: 10px;
      margin: 8px 0 10px;
    }

    .time{
      font-variant-numeric: tabular-nums;
      font-size: 12px;
      opacity: .85;
      min-width: 42px;
      text-align: center;
    }

    input[type="range"]{
      -webkit-appearance:none;
      appearance:none;
      width:100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,.16);
      outline:none;
      cursor:pointer;
    }
    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none;
      appearance:none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(0,0,0,.15);
    }

    .controls{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 4px;
    }

    .mainControls{
      display:flex;
      gap: 10px;
      align-items:center;
    }

    .bigPlay{
      width: 46px;
      height: 46px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      border: none;
      cursor: pointer;
      display:grid;
      place-items:center;
      box-shadow: 0 10px 18px rgba(0,0,0,.22);
    }

    .bigPlay span{
      color:#101010;
      font-size: 18px;
      transform: translateX(1px);
    }

    .tinyBtn{
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.9);
      cursor:pointer;
      display:grid;
      place-items:center;
      user-select:none;
      font-size: 14px;
    }

    /* Manual BG toggle (testing) */
    #bgToggle {
      position: fixed;
      bottom: 16px;
      right: 16px;
      display: flex;
      gap: 6px;
      opacity: 0.20;
      z-index: 20;
      transition: opacity 160ms ease;
      user-select:none;
    }
    #bgToggle:hover { opacity: 0.9; }
    #bgToggle button {
      background: rgba(255,255,255,0.55);
      border: none;
      border-radius: 999px;
      width: 34px;
      height: 34px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,.16);
    }

    /* Small hint (optional) */
    .tinyHint{
      position: fixed;
      right: 18px;
      top: 14px;
      font-size: 12px;
      opacity: .65;
      z-index: 20;
      background: rgba(0,0,0,.30);
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(10px);
      display:none; /* keep hidden */
    }

    @media (max-width: 520px){
      .note{ padding: 26px 22px 20px; }
      .player{ left: 12px; right: 12px; width: auto; }
      #bgToggle{ right: 12px; bottom: 12px; }
    }
  </style>
</head>

<body>
  <div class="stage">
    <div class="bg background"></div>

    <div class="clouds" aria-hidden="true">
      <img class="cloud one" src="cloud.png" alt="">
      <img class="cloud two" src="cloud.png" alt="">
    </div>

    <div class="tintGlass" id="tintGlass"></div>
  </div>

  <div class="centerWhisper" id="centerWhisper">
    <span>I wanted to give you something you could stay in.</span>
  </div>

  <div class="ui">
    <div class="noteWrap">
      <div class="note" id="note">
        <div class="noteInner" id="noteInner">
          <h1>Hello my love,</h1>

          <p>I can‚Äôt believe we are already having our first Valentine‚Äôs Day.</p>
          <p>In a way you have been helping turn my life into a work of art.</p>
          <p>So this is my little ode to you, me, and us.</p>
          <p>Thank you for being my <b>Muse</b>!</p>

          <div class="sig">
            ‚Äì Love Sweets üç≠
            <small>V.D 2026</small>
          </div>

          <div class="row" id="askRow">
            <div style="flex:1; min-width: 220px; font-weight:800;">
              Will you be my Valentine? üíñ
            </div>
            <button class="btn btnYes" id="yesBtn">Yes</button>
            <button class="btn btnNo" id="noBtn">No</button>
          </div>

          <div class="row" id="enterRow" style="display:none;">
            <button class="btn btnEnter" id="enterBtn">Enter the painting ‚ú®</button>
          </div>

          <div class="row" id="resetRow" style="display:none;">
            <button class="btn btnReset" id="resetBtn">Reset</button>
          </div>

          <div class="noLine" id="noLine" style="display:none;">
            ‚òπÔ∏è
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PLAYER (hidden until Enter) -->
  <div class="player" id="player">
    <div class="playerTop">
      <div class="trackTitle" title="">
        <span class="marquee" id="trackText">To My Everything üíó</span>
      </div>
      <div class="modes">
        <button class="chip" id="shuffleBtn" title="Shuffle">üîÄ</button>
        <button class="chip" id="repeatBtn" title="Repeat">üîÅ</button>
      </div>
    </div>

    <div class="progressRow">
      <div class="time" id="tNow">0:00</div>
      <input type="range" id="seek" min="0" max="1000" value="0" />
      <div class="time" id="tDur">0:00</div>
    </div>

    <div class="controls">
      <div class="mainControls">
        <button class="tinyBtn" id="prevBtn" title="Prev">‚èÆ</button>
        <button class="bigPlay" id="playBtn" title="Play/Pause"><span id="playIcon">‚ñ∂</span></button>
        <button class="tinyBtn" id="nextBtn" title="Next">‚è≠</button>
      </div>

      <button class="tinyBtn" id="heartBtn" title="Love">‚ô°</button>
    </div>
  </div>

  <!-- Manual BG toggle (testing) -->
  <div id="bgToggle" title="Manual background toggle (testing)">
    <button data-bg="sunrise">‚òÄÔ∏è</button>
    <button data-bg="sunset">üåÖ</button>
    <button data-bg="midnight">üåô</button>
  </div>

  <audio id="audio" preload="metadata"></audio>

  <script>
    // ---------------------------
    // BACKGROUNDS (auto + manual)
    // ---------------------------
    const bgEl = document.querySelector(".background");
    const tintGlass = document.getElementById("tintGlass");

    const backgrounds = {
      sunrise: "Sunrise.png",
      sunset: "Sunset.png",
      midnight: "Midnight.png",
    };

    function getAutoBgKey(){
      const h = new Date().getHours();
      // Adjust if you want different cutoffs
      if (h >= 6 && h < 16) return "sunrise";   // morning/day
      if (h >= 16 && h < 20) return "sunset";   // golden/evening
      return "midnight";                        // night
    }

    function setBackground(key){
      const url = backgrounds[key] || backgrounds.sunrise;
      bgEl.style.opacity = 0;

      setTimeout(() => {
        bgEl.style.backgroundImage = `url('${url}')`;
        bgEl.style.opacity = 1;
      }, 450);
    }

    // Init background
    setBackground(getAutoBgKey());

    // Re-check hourly in auto mode (simple)
    setInterval(() => {
      if (!manualBgMode) setBackground(getAutoBgKey());
    }, 60 * 60 * 1000);

    // Manual toggle (testing)
    let manualBgMode = false;
    document.querySelectorAll("#bgToggle button").forEach(btn => {
      btn.addEventListener("click", () => {
        manualBgMode = true;
        setBackground(btn.dataset.bg);
      });
    });

    // ---------------------------
    // DAY 2: NOTE FLOW
    // ---------------------------
    const note = document.getElementById("note");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const askRow = document.getElementById("askRow");
    const enterRow = document.getElementById("enterRow");
    const enterBtn = document.getElementById("enterBtn");
    const resetRow = document.getElementById("resetRow");
    const resetBtn = document.getElementById("resetBtn");
    const noLine = document.getElementById("noLine");
    const centerWhisper = document.getElementById("centerWhisper");

    let accepted = false;
    let entered = false;

    // Whisper shows on load (subtle)
    setTimeout(() => centerWhisper.style.opacity = 1, 550);

    function hideWhisper(){
      centerWhisper.style.opacity = 0;
    }

    yesBtn.addEventListener("click", () => {
      accepted = true;

      // Reveal enter button
      askRow.style.display = "none";
      enterRow.style.display = "flex";
      resetRow.style.display = "none";

      // Remove the tint a little (still behind glass until Enter)
      tintGlass.style.opacity = 0.65;

      // Make it feel like a gentle "yes"
      note.style.transform = "translateY(-2px)";
      setTimeout(() => note.style.transform = "translateY(0px)", 240);
    });

    noBtn.addEventListener("click", () => {
      accepted = false;

      // Darken paper, show frown + reset
      note.classList.add("nope");
      askRow.style.display = "none";
      enterRow.style.display = "none";
      resetRow.style.display = "flex";
      noLine.style.display = "block";
    });

    resetBtn.addEventListener("click", () => {
      // Reset everything
      accepted = false;
      entered = false;

      note.classList.remove("nope");
      askRow.style.display = "flex";
      enterRow.style.display = "none";
      resetRow.style.display = "none";
      noLine.style.display = "none";

      tintGlass.style.opacity = 1;
      document.getElementById("player").style.display = "none";

      // Stop audio too
      stopAudio();
      setPlayerIdleTitle();
    });

    enterBtn.addEventListener("click", () => {
      if (!accepted) return;
      entered = true;

      // Fade note away
      note.style.opacity = 0;
      note.style.transform = "translateY(10px)";
      note.style.filter = "blur(2px)";

      // Remove tint glass
      tintGlass.style.opacity = 0;

      // Whisper fades away
      hideWhisper();

      // Show player
      document.getElementById("player").style.display = "block";

      // Remove note from layout after animation
      setTimeout(() => {
        note.style.display = "none";
      }, 650);
    });

    // ---------------------------
    // PLAYLIST + PLAYER
    // ---------------------------
    const audio = document.getElementById("audio");
    const seek = document.getElementById("seek");
    const tNow = document.getElementById("tNow");
    const tDur = document.getElementById("tDur");
    const playBtn = document.getElementById("playBtn");
    const playIcon = document.getElementById("playIcon");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const repeatBtn = document.getElementById("repeatBtn");
    const trackText = document.getElementById("trackText");
    const heartBtn = document.getElementById("heartBtn");

    const playlist = [
      { file: "everything.mp3", title: "Everything", artist: "Gotts Street Park (feat. Rosie Lowe)" },
      { file: "IIHANDS.mp3", title: "II HANDS II HEAVEN", artist: "Beyonc√©" },
      { file: "POV.mp3", title: "pov", artist: "Ariana Grande" },
      { file: "Sweet.mp3", title: "Sweet Love", artist: "Anita Baker" },
      { file: "OurLove.mp3", title: "Our Love", artist: "Curtis Harding & Jazmine Sullivan" },
      { file: "Floating.mp3", title: "Floating", artist: "Alina Baraz" },
      { file: "All.mp3", title: "All In", artist: "Desiree Dawson" },
      { file: "End.mp3", title: "End of the Night", artist: "Kenny G" },
      { file: "Myone.mp3", title: "My One and Only Love", artist: "John Coltrane" },
      { file: "Ribbon.mp3", title: "Ribbon in the Sky", artist: "Stevie Wonder" },
      { file: "Nothing.mp3", title: "Nothing Even Matters", artist: "Lauryn Hill (feat. D'Angelo)" },
    ];

    let idx = 0;
    let isPlaying = false;
    let shuffle = false;
    let repeat = false;
    let lastSeekUser = false;

    function fmtTime(s){
      if (!isFinite(s) || s < 0) return "0:00";
      const m = Math.floor(s / 60);
      const r = Math.floor(s % 60);
      return `${m}:${String(r).padStart(2,"0")}`;
    }

    function setMarquee(text){
      trackText.textContent = text;

      // Toggle marquee only if text is longer than container width
      // quick heuristic: length > 26
      trackText.classList.remove("run");
      if (text.length > 26){
        // Duplicate text for smoother scroll illusion
        trackText.textContent = text + "   ‚Ä¢   " + text;
        trackText.classList.add("run");
      }
    }

    function setPlayerIdleTitle(){
      setMarquee("To My Everything üíó");
    }

    function setTrack(i){
      idx = (i + playlist.length) % playlist.length;
      const tr = playlist[idx];
      audio.src = tr.file;

      setMarquee(`${tr.title} ‚Äî ${tr.artist}`);
      // reset progress UI until metadata loads
      seek.value = 0;
      tNow.textContent = "0:00";
      tDur.textContent = "0:00";
    }

    function playAudio(){
      if (!audio.src) setTrack(idx);

      audio.play().then(() => {
        isPlaying = true;
        playIcon.textContent = "‚è∏";
      }).catch(() => {
        // Autoplay may be blocked; user will click again.
        isPlaying = false;
        playIcon.textContent = "‚ñ∂";
      });
    }

    function pauseAudio(){
      audio.pause();
      isPlaying = false;
      playIcon.textContent = "‚ñ∂";
    }

    function stopAudio(){
      pauseAudio();
      audio.currentTime = 0;
      seek.value = 0;
      tNow.textContent = "0:00";
    }

    function nextTrack(){
      if (shuffle){
        idx = Math.floor(Math.random() * playlist.length);
      } else {
        idx = (idx + 1) % playlist.length;
      }
      setTrack(idx);
      playAudio();
    }

    function prevTrack(){
      // if not far into track, go prev; else restart
      if (audio.currentTime > 2.5){
        audio.currentTime = 0;
        return;
      }
      idx = (idx - 1 + playlist.length) % playlist.length;
      setTrack(idx);
      playAudio();
    }

    playBtn.addEventListener("click", () => {
      if (!audio.src){
        setTrack(idx);
      }
      if (isPlaying) pauseAudio();
      else playAudio();
    });

    nextBtn.addEventListener("click", nextTrack);
    prevBtn.addEventListener("click", prevTrack);

    shuffleBtn.addEventListener("click", () => {
      shuffle = !shuffle;
      shuffleBtn.classList.toggle("on", shuffle);
    });

    repeatBtn.addEventListener("click", () => {
      repeat = !repeat;
      repeatBtn.classList.toggle("on", repeat);
      audio.loop = repeat; // simple repeat-one behavior
    });

    heartBtn.addEventListener("click", () => {
      // purely cute UI toggle
      const on = heartBtn.textContent !== "‚ô°";
      heartBtn.textContent = on ? "‚ô°" : "‚ô•";
    });

    // Sync progress
    audio.addEventListener("loadedmetadata", () => {
      tDur.textContent = fmtTime(audio.duration);
    });

    audio.addEventListener("timeupdate", () => {
      if (!isFinite(audio.duration) || audio.duration === 0) return;
      tNow.textContent = fmtTime(audio.currentTime);

      if (!lastSeekUser){
        const v = Math.floor((audio.currentTime / audio.duration) * 1000);
        seek.value = String(v);
      }
    });

    // Seek interactions
    seek.addEventListener("pointerdown", () => { lastSeekUser = true; });
    seek.addEventListener("pointerup", () => {
      lastSeekUser = false;
      if (!isFinite(audio.duration) || audio.duration === 0) return;
      const pct = Number(seek.value) / 1000;
      audio.currentTime = pct * audio.duration;
    });

    seek.addEventListener("input", () => {
      // live preview time while dragging
      if (!isFinite(audio.duration) || audio.duration === 0) return;
      const pct = Number(seek.value) / 1000;
      const preview = pct * audio.duration;
      tNow.textContent = fmtTime(preview);
    });

    audio.addEventListener("ended", () => {
      if (repeat) return; // loop handles it
      nextTrack();
    });

    // Initialize player idle
    setPlayerIdleTitle();
    // preload first track metadata once entered (optional)
    // setTrack(idx); // uncomment if you want it ready immediately

  </script>
</body>
</html>
