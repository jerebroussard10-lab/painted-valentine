<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Painted Valentine</title>
  <style>
    :root{
      --cream:#f8f1e6;
      --ink:#141414;
      --glass: rgba(20,20,20,0.22);
      --glass2: rgba(20,20,20,0.36);
      --pink:#ff7eb6; /* lighter pink */
      --radius: 22px;
      --shadow: 0 18px 55px rgba(0,0,0,.35);
      --softShadow: 0 10px 35px rgba(0,0,0,.22);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    body{
      background:#000;
      overflow:hidden;
      color:#fff;
    }

    /* Scene */
    .scene{
      position:fixed; inset:0;
      background: #000;
    }

    /* Painting background */
    .bg{
      position:absolute; inset:0;
      background-image:url("Midnight.png");
      background-size:cover;
      background-position:center;
      transform: scale(1.03);
      will-change: transform, filter;
      animation: bgDrift 26s ease-in-out infinite alternate;
      filter: saturate(1.05) contrast(1.05);
    }
    @keyframes bgDrift{
      0%{ transform: scale(1.03) translate3d(-6px,-4px,0); }
      100%{ transform: scale(1.06) translate3d(6px,4px,0); }
    }

    /* ‚ÄúTinted glass‚Äù over painting before YES */
    .tint{
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(10,10,18,.30), rgba(10,10,18,.38));
      backdrop-filter: blur(14px) saturate(1.05);
      -webkit-backdrop-filter: blur(14px) saturate(1.05);
      transition: opacity 700ms ease;
      opacity:1;
      pointer-events:none;
    }
    .scene.revealed .tint{ opacity:0; }

    /* Stars layer (behind clouds) */
    .stars{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:0;
      transition: opacity 900ms ease;
      mix-blend-mode: screen;
    }
    .scene.revealed .stars{ opacity:1; }

    /* Star dots */
    .star{
      position:absolute;
      width:2px; height:2px;
      border-radius:999px;
      background: rgba(255,255,255,.8);
      box-shadow: 0 0 10px rgba(255,255,255,.35);
      opacity:.25;
      animation: twinkle var(--tw, 4s) ease-in-out infinite;
    }
    @keyframes twinkle{
      0%,100%{ opacity:.15; transform:scale(1); }
      50%{ opacity:.85; transform:scale(1.35); }
    }

    /* Clouds (on top of stars) */
    .clouds{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:0;
      transition: opacity 900ms ease;
    }
    .scene.revealed .clouds{ opacity:1; }

    .cloud{
      position:absolute;
      top: var(--top, 16%);
      left: -45%;
      width: var(--w, 58vw);
      height: auto;
      opacity: var(--op, .55);
      filter: blur(var(--blur, 0px)) brightness(1.05) contrast(1.02);
      transform: translate3d(0,0,0);
      will-change: transform, opacity;
      animation: cloudDrift var(--dur, 110s) linear infinite;
      animation-delay: var(--delay, 0s);
    }
    /* drift fully across */
    @keyframes cloudDrift{
      0%{ transform: translate3d(-10vw, 0, 0); opacity:0; }
      8%{ opacity: var(--op, .55); }
      92%{ opacity: var(--op, .55); }
      100%{ transform: translate3d(160vw, 0, 0); opacity:0; }
    }

    /* Fireflies */
    .fireflies{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:0;
      transition: opacity 900ms ease;
    }
    .scene.revealed .fireflies{ opacity:1; }

    .fly{
      position:absolute;
      width:4px; height:4px;
      border-radius:999px;
      background: rgba(255, 214, 102, .95);
      box-shadow:
        0 0 14px rgba(255, 214, 102, .65),
        0 0 32px rgba(255, 214, 102, .28);
      opacity:.35;
      animation:
        floaty var(--fd, 10s) ease-in-out infinite alternate,
        blink var(--bd, 3.6s) ease-in-out infinite;
    }
    @keyframes blink{
      0%,100%{ opacity:.25; transform: scale(.9); }
      50%{ opacity:.95; transform: scale(1.35); }
    }
    @keyframes floaty{
      0%{ transform: translate3d(0,0,0); }
      100%{ transform: translate3d(var(--dx, 18px), var(--dy, -16px), 0); }
    }

    /* Top fade line text */
    .tagline{
      position:absolute;
      top: 7vh;
      width:100%;
      text-align:center;
      font-style: italic;
      font-size: clamp(16px, 2.1vw, 22px);
      letter-spacing:.2px;
      color: rgba(255,255,255,.92);
      text-shadow: 0 8px 22px rgba(0,0,0,.45);
      opacity:1;
      transition: opacity 1.2s ease;
      pointer-events:none;
      z-index:10;
    }
    .scene.revealed .tagline{ opacity:0; }

    /* Center note overlay */
    .overlay{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 20px;
      z-index: 20;
    }

    .card{
      width:min(860px, 92vw);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      background: rgba(248,241,230,.96);
      color: var(--ink);
      padding: clamp(22px, 3vw, 34px);
      position:relative;
      overflow:hidden;
      transform: translateY(0);
      transition: opacity 650ms ease, transform 650ms ease, background 500ms ease, color 500ms ease;
    }

    .card:before{
      content:"";
      position:absolute; inset:-30%;
      background: radial-gradient(circle at 20% 20%, rgba(255,255,255,.55), transparent 55%),
                  radial-gradient(circle at 80% 50%, rgba(255,255,255,.35), transparent 58%);
      opacity:.5;
      pointer-events:none;
    }

    .card h2{
      margin:0 0 10px 0;
      font-size: clamp(18px, 2.2vw, 24px);
    }

    .card p{
      margin: 10px 0;
      line-height: 1.55;
      font-size: clamp(15px, 1.6vw, 18px);
    }

    .sig{
      margin-top: 18px;
      font-weight: 650;
    }
    .sig small{
      display:block;
      margin-top: 6px;
      opacity:.8;
      font-weight: 600;
    }

    .askRow{
      margin-top: 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 16px;
    }
    .askText{
      font-weight: 800;
      font-size: clamp(17px, 2.0vw, 22px);
    }

    .btnRow{
      display:flex;
      gap: 10px;
      align-items:center;
    }
    button{
      border:0;
      border-radius: 999px;
      padding: 10px 16px;
      font-weight: 700;
      cursor:pointer;
      box-shadow: var(--softShadow);
      transition: transform .12s ease, opacity .2s ease, background .2s ease;
    }
    button:active{ transform: translateY(1px) scale(.99); }

    .yes{
      background:#111;
      color:#fff;
    }
    .no{
      background:#fff;
      color:#111;
      border: 1px solid rgba(0,0,0,.12);
    }
    .reset{
      background:#fff;
      color:#111;
      border: 1px solid rgba(255,255,255,.18);
      display:none;
    }

    /* NO state */
    .card.nope{
      background: rgba(12,12,12,.88);
      color: #f4f4f4;
    }

    .sadFace{
      display:none;
      position:absolute;
      left:50%;
      top:58%;
      transform: translate(-50%,-50%);
      font-size: 64px;
      filter: drop-shadow(0 10px 30px rgba(0,0,0,.35));
      opacity:.95;
      pointer-events:none;
    }
    .card.nope .sadFace{ display:block; }

    /* Hide overlay when revealed */
    .overlay.hidden .card{
      opacity:0;
      transform: translateY(10px);
      pointer-events:none;
    }

    /* Player */
    .playerWrap{
      position:absolute;
      left:50%;
      bottom: clamp(14px, 3vh, 24px);
      transform: translateX(-50%);
      width: min(780px, 92vw);
      z-index: 30;
      opacity:0;
      pointer-events:none;
      transition: opacity 700ms ease, transform 700ms ease;
    }
    .scene.revealed .playerWrap{
      opacity:1;
      pointer-events:auto;
      transform: translateX(-50%) translateY(0);
    }

    .player{
      border-radius: 22px;
      background: rgba(25,25,28,.26);
      backdrop-filter: blur(18px) saturate(1.1);
      -webkit-backdrop-filter: blur(18px) saturate(1.1);
      box-shadow: 0 16px 50px rgba(0,0,0,.35);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.08);
    }

    .playerHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 14px 14px 10px 14px;
    }

    .trackMeta{
      min-width: 0;
    }
    .trackTitle{
      font-weight: 800;
      letter-spacing:.2px;
      font-size: 16px;
      display:flex;
      align-items:center;
      gap: 8px;
      color: rgba(255,255,255,.95);
    }
    .heart{
      color: var(--pink);
      text-shadow: 0 0 14px rgba(255,126,182,.25);
    }

    /* marquee */
    .marquee{
      min-width:0;
      overflow:hidden;
      white-space:nowrap;
      position:relative;
      max-width: 52vw;
    }
    .marquee span{
      display:inline-block;
      padding-right: 40px;
      animation: marquee 11s linear infinite;
    }
    .marquee.paused span{ animation-play-state: paused; }
    @keyframes marquee{
      0%{ transform: translateX(0); }
      100%{ transform: translateX(-50%); }
    }

    .subTitle{
      font-size: 12px;
      opacity:.82;
      margin-top: 2px;
      color: rgba(255,255,255,.82);
    }

    .controlsTop{
      display:flex;
      align-items:center;
      gap: 8px;
    }

    .iconBtn{
      width: 34px;
      height: 34px;
      border-radius: 10px;
      background: rgba(255,255,255,.08);
      color:#fff;
      border: 1px solid rgba(255,255,255,.10);
      display:grid;
      place-items:center;
      box-shadow:none;
      padding:0;
      opacity:.95;
    }
    .iconBtn.active{
      background: rgba(255,255,255,.18);
      border-color: rgba(255,255,255,.22);
    }

    .barRow{
      padding: 0 14px 12px 14px;
    }
    input[type="range"]{
      width:100%;
      accent-color: rgba(255,255,255,.85);
    }

    .timeRow{
      margin-top: 4px;
      display:flex;
      justify-content:space-between;
      font-size: 12px;
      color: rgba(255,255,255,.78);
    }

    /* Main transport row (centered) */
    .transport{
      display:flex;
      justify-content:center;
      align-items:center;
      gap: 14px;
      padding: 10px 14px 14px 14px;
    }

    .tBtn{
      width: 42px;
      height: 42px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      color:#fff;
      border: 1px solid rgba(255,255,255,.12);
      display:grid;
      place-items:center;
      box-shadow:none;
    }
    .playBtn{
      width: 54px;
      height: 54px;
      background: rgba(255,255,255,.92);
      color:#111;
      border: none;
    }

    .playerBody{
      max-height: 260px;
      transition: max-height 420ms ease;
      overflow:hidden;
    }
    .player.collapsed .playerBody{
      max-height: 0px;
    }

    /* Playlist drawer */
    .drawer{
      padding: 0 14px 14px 14px;
    }
    .list{
      margin-top: 10px;
      display:grid;
      gap: 8px;
      max-height: 140px;
      overflow:auto;
      padding-right: 6px;
    }
    .item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      cursor:pointer;
    }
    .item:hover{ background: rgba(255,255,255,.085); }
    .item.active{
      background: rgba(255,126,182,.14);
      border-color: rgba(255,126,182,.22);
    }
    .item .name{
      color: rgba(255,255,255,.92);
      font-size: 13px;
      font-weight: 750;
    }
    .item .artist{
      color: rgba(255,255,255,.72);
      font-size: 12px;
      margin-top: 2px;
    }
    .item .dur{
      color: rgba(255,255,255,.70);
      font-size: 12px;
      font-variant-numeric: tabular-nums;
    }

    /* little UI for the ‚Äúlike‚Äù */
    .likeBtn{
      width:34px;height:34px;border-radius:10px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      display:grid;place-items:center;
    }

    /* small screens */
    @media (max-width: 520px){
      .marquee{ max-width: 56vw; }
      .trackTitle{ font-size: 14px; }
      .playerWrap{ width: 94vw; }
      .card{ width: 94vw; }
      .askRow{ flex-direction:column; align-items:flex-start; }
      .btnRow{ align-self:flex-end; }
    }
  </style>
</head>

<body>
  <div id="scene" class="scene">
    <div class="bg" aria-hidden="true"></div>
    <div class="tint" aria-hidden="true"></div>

    <div class="stars" id="stars" aria-hidden="true"></div>

    <div class="clouds" id="clouds" aria-hidden="true">
      <!-- Clouds will be injected -->
    </div>

    <div class="fireflies" id="fireflies" aria-hidden="true"></div>

    <div class="tagline" id="tagline">I wanted to give you something you could stay in.</div>

    <!-- Overlay (ask note) -->
    <div class="overlay" id="overlay">
      <div class="card" id="card">
        <div class="sadFace" id="sadFace">üòû</div>

        <h2>Hello my love,</h2>

        <p>I can‚Äôt believe we are already having our first Valentine‚Äôs Day.</p>
        <p>In a way you have been helping turn my life into a work of art.</p>
        <p>So this is my little ode to you, me, and us.</p>
        <p>Thank you for being my <strong>Muse</strong>!</p>

        <p class="sig">‚Äì Love Sweets üç≠<small>V.D 2026</small></p>

        <div class="askRow" id="askRow">
          <div class="askText">Will you be my Valentine? <span class="heart">üíó</span></div>
          <div class="btnRow" id="btnRow">
            <button class="yes" id="yesBtn">Yes</button>
            <button class="no" id="noBtn">No</button>
            <button class="reset" id="resetBtn">Reset</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Player -->
    <div class="playerWrap" id="playerWrap">
      <div class="player collapsed" id="player">
        <div class="playerHeader">
          <div class="trackMeta">
            <div class="trackTitle">
              <div class="marquee paused" id="marquee">
                <span id="trackLineA">To My Everything <span class="heart">üíó</span> ‚Ä¢ </span>
                <span id="trackLineB">To My Everything <span class="heart">üíó</span> ‚Ä¢ </span>
              </div>
            </div>
            <div class="subTitle" id="subTitle">V.D 2026 playlist</div>
          </div>

          <div class="controlsTop">
            <button class="iconBtn" id="shuffleBtn" title="Shuffle">üîÄ</button>
            <button class="iconBtn" id="repeatBtn" title="Repeat">üîÅ</button>
            <button class="iconBtn" id="collapseBtn" title="Expand / Collapse">‚ñæ</button>
            <div class="likeBtn" title="Love">‚ô°</div>
          </div>
        </div>

        <div class="playerBody" id="playerBody">
          <div class="barRow">
            <input id="seek" type="range" min="0" max="1000" value="0" />
            <div class="timeRow">
              <span id="tCur">0:00</span>
              <span id="tDur">0:00</span>
            </div>
          </div>

          <div class="transport">
            <button class="tBtn" id="prevBtn" title="Previous">‚èÆ</button>
            <button class="playBtn" id="playBtn" title="Play / Pause">‚ñ∂</button>
            <button class="tBtn" id="nextBtn" title="Next">‚è≠</button>
          </div>

          <div class="drawer">
            <div class="list" id="list"></div>
          </div>
        </div>
      </div>

      <audio id="audio" preload="metadata"></audio>
    </div>
  </div>

  <script>
    // ---------- Playlist (your file names + your song/artist mapping) ----------
    const playlist = [
      { file: "everything.mp3", title: "Everything", artist: "Gotts Street Park feat. Rosie Lowe" },
      { file: "POV.mp3",       title: "pov",       artist: "Ariana Grande" },
      { file: "IIHANDS.mp3",   title: "II HANDS II HEAVEN", artist: "Beyonc√©" },
      { file: "Sweet.mp3",     title: "Sweet Love", artist: "Anita Baker" },
      { file: "OurLove.mp3",   title: "Our Love", artist: "Curtis Harding & Jazmine Sullivan" },
      { file: "Floating.mp3",  title: "Floating", artist: "Alina Baraz" },
      { file: "All.mp3",       title: "All In", artist: "Desir√©e Dawson" },
      { file: "End.mp3",       title: "End of the Night", artist: "Kenny G" },
      { file: "Myone.mp3",     title: "My One and Only Love", artist: "John Coltrane" },
      { file: "Ribbon.mp3",    title: "Ribbon in the Sky", artist: "Stevie Wonder" },
      { file: "Nothing.mp3",   title: "Nothing Even Matters", artist: "Lauryn Hill" }
    ];

    // ---------- Elements ----------
    const scene = document.getElementById("scene");
    const overlay = document.getElementById("overlay");
    const card = document.getElementById("card");
    const askRow = document.getElementById("askRow");
    const btnRow = document.getElementById("btnRow");

    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const resetBtn = document.getElementById("resetBtn");

    const playerWrap = document.getElementById("playerWrap");
    const player = document.getElementById("player");
    const collapseBtn = document.getElementById("collapseBtn");

    const shuffleBtn = document.getElementById("shuffleBtn");
    const repeatBtn = document.getElementById("repeatBtn");

    const audio = document.getElementById("audio");
    const seek = document.getElementById("seek");
    const tCur = document.getElementById("tCur");
    const tDur = document.getElementById("tDur");

    const playBtn = document.getElementById("playBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    const listEl = document.getElementById("list");
    const marquee = document.getElementById("marquee");
    const trackLineA = document.getElementById("trackLineA");
    const trackLineB = document.getElementById("trackLineB");
    const subTitle = document.getElementById("subTitle");

    const starsEl = document.getElementById("stars");
    const cloudsEl = document.getElementById("clouds");
    const firefliesEl = document.getElementById("fireflies");

    // ---------- State ----------
    let currentIndex = 0;
    let isShuffle = false;
    let isRepeat = false;
    let userHasEntered = false;

    // ---------- Helpers ----------
    function padTime(sec){
      if(!isFinite(sec) || sec < 0) return "0:00";
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60);
      return `${m}:${String(s).padStart(2,"0")}`;
    }

    function setMarqueeText(text){
      // duplicate text so marquee loops cleanly
      trackLineA.innerHTML = `${text} ‚Ä¢ `;
      trackLineB.innerHTML = `${text} ‚Ä¢ `;
    }

    function updateListUI(){
      [...listEl.children].forEach((row, i)=>{
        row.classList.toggle("active", i === currentIndex);
      });
    }

    function loadTrack(index, autoplay=false){
      currentIndex = (index + playlist.length) % playlist.length;
      const tr = playlist[currentIndex];
      audio.src = tr.file;

      // label when playing: "song ‚Äî artist"
      const label = `${tr.title} ‚Äî ${tr.artist}`;
      setMarqueeText(label);
      marquee.classList.remove("paused");
      subTitle.textContent = "V.D 2026 playlist";

      updateListUI();

      // wait for metadata to paint duration
      audio.addEventListener("loadedmetadata", () => {
        tDur.textContent = padTime(audio.duration);
      }, { once:true });

      if(autoplay){
        audio.play().then(()=>{
          playBtn.textContent = "‚è∏";
        }).catch(()=>{
          // autoplay blocked until user gesture ‚Äî keep paused
          playBtn.textContent = "‚ñ∂";
        });
      } else {
        playBtn.textContent = "‚ñ∂";
      }
    }

    function setIdleTitle(){
      setMarqueeText(`To My Everything <span class="heart">üíó</span>`);
      marquee.classList.add("paused");
      subTitle.textContent = "V.D 2026 playlist";
    }

    function nextTrack(autoplay=true){
      if(isShuffle){
        let pick = Math.floor(Math.random()*playlist.length);
        if(playlist.length > 1){
          while(pick === currentIndex) pick = Math.floor(Math.random()*playlist.length);
        }
        loadTrack(pick, autoplay);
      } else {
        loadTrack(currentIndex + 1, autoplay);
      }
    }

    function prevTrack(){
      loadTrack(currentIndex - 1, true);
    }

    // ---------- Build playlist UI ----------
    function buildList(){
      listEl.innerHTML = "";
      playlist.forEach((tr, i)=>{
        const row = document.createElement("div");
        row.className = "item";
        row.innerHTML = `
          <div>
            <div class="name">${tr.title}</div>
            <div class="artist">${tr.artist}</div>
          </div>
          <div class="dur" data-dur="${tr.file}">--:--</div>
        `;
        row.addEventListener("click", ()=>{
          loadTrack(i, true);
        });
        listEl.appendChild(row);

        // Try to fetch duration in the background (optional)
        const probe = new Audio(tr.file);
        probe.preload = "metadata";
        probe.addEventListener("loadedmetadata", ()=>{
          const durEl = row.querySelector(".dur");
          durEl.textContent = padTime(probe.duration);
          probe.src = "";
        }, { once:true });
      });
      updateListUI();
    }

    // ---------- Particles: stars + fireflies ----------
    function makeStars(count=120){
      starsEl.innerHTML = "";
      const W = window.innerWidth, H = window.innerHeight;
      for(let i=0;i<count;i++){
        const s = document.createElement("div");
        s.className = "star";
        const x = Math.random()*W;
        const y = Math.random()*H*0.75; // mostly sky
        const size = (Math.random()<0.15) ? 3 : 2;
        s.style.left = x+"px";
        s.style.top = y+"px";
        s.style.width = size+"px";
        s.style.height = size+"px";
        s.style.opacity = (0.12 + Math.random()*0.55).toFixed(2);
        s.style.setProperty("--tw", (2.6 + Math.random()*4.8).toFixed(2)+"s");
        starsEl.appendChild(s);
      }
    }

    function makeFireflies(count=26){
      firefliesEl.innerHTML = "";
      const W = window.innerWidth, H = window.innerHeight;
      for(let i=0;i<count;i++){
        const f = document.createElement("div");
        f.className = "fly";
        // place them mostly lower third
        const x = Math.random()*W;
        const y = H*(0.55 + Math.random()*0.38);
        f.style.left = x+"px";
        f.style.top = y+"px";
        f.style.setProperty("--fd", (8 + Math.random()*10).toFixed(2)+"s");
        f.style.setProperty("--bd", (2.4 + Math.random()*3.6).toFixed(2)+"s");
        f.style.setProperty("--dx", ((Math.random()*40)-20).toFixed(0)+"px");
        f.style.setProperty("--dy", ((Math.random()*34)-17).toFixed(0)+"px");
        firefliesEl.appendChild(f);
      }
    }

    // ---------- Clouds: multiple layers, slow drift ----------
    function makeClouds(){
      cloudsEl.innerHTML = "";
      const clouds = [
        { top:"16%", w:"62vw", op:.42, blur:"0px", dur:"120s", delay:"0s"  },
        { top:"22%", w:"54vw", op:.32, blur:"1px", dur:"110s", delay:"-22s"},
        { top:"12%", w:"70vw", op:.24, blur:"2px", dur:"140s", delay:"-55s"},
        { top:"28%", w:"46vw", op:.28, blur:"1.5px", dur:"130s", delay:"-80s"},
      ];
      clouds.forEach(cfg=>{
        const img = document.createElement("img");
        img.className = "cloud";
        img.src = "cloud.png";
        img.alt = "";
        img.style.setProperty("--top", cfg.top);
        img.style.setProperty("--w", cfg.w);
        img.style.setProperty("--op", cfg.op);
        img.style.setProperty("--blur", cfg.blur);
        img.style.setProperty("--dur", cfg.dur);
        img.style.setProperty("--delay", cfg.delay);
        cloudsEl.appendChild(img);
      });
    }

    // ---------- Reveal logic ----------
    function revealPainting(){
      if(userHasEntered) return;
      userHasEntered = true;

      // hide overlay card with fade, keep tagline fading automatically via CSS
      overlay.classList.add("hidden");

      // reveal scene + player
      scene.classList.add("revealed");

      // open player by default on desktop, collapsed on small screens
      if(window.innerWidth <= 520){
        player.classList.add("collapsed");
        collapseBtn.textContent = "‚ñ¥";
      } else {
        player.classList.remove("collapsed");
        collapseBtn.textContent = "‚ñæ";
      }

      // init ambience
      makeStars(140);
      makeFireflies(28);
      makeClouds();
    }

    // ---------- NO logic ----------
    function setNoState(){
      card.classList.add("nope");

      // remove question line + buttons, show reset only
      // keep text + signature
      const askTextEl = askRow.querySelector(".askText");
      if(askTextEl) askTextEl.style.display = "none";

      yesBtn.style.display = "none";
      noBtn.style.display = "none";
      resetBtn.style.display = "inline-block";

      // Ensure overlay stays visible (don‚Äôt reveal painting)
      overlay.classList.remove("hidden");
    }

    function resetAll(){
      // stop audio
      audio.pause();
      audio.currentTime = 0;

      // reset state
      userHasEntered = false;
      scene.classList.remove("revealed");
      overlay.classList.remove("hidden");

      // reset card
      card.classList.remove("nope");

      // restore ask UI
      const askTextEl = askRow.querySelector(".askText");
      if(askTextEl) askTextEl.style.display = "";

      yesBtn.style.display = "";
      noBtn.style.display = "";
      resetBtn.style.display = "none";

      // reset player
      player.classList.add("collapsed");
      collapseBtn.textContent = "‚ñ¥";
      setIdleTitle();
      playBtn.textContent = "‚ñ∂";
      seek.value = 0;
      tCur.textContent = "0:00";
      tDur.textContent = "0:00";

      // clear ambience
      starsEl.innerHTML = "";
      firefliesEl.innerHTML = "";
      cloudsEl.innerHTML = "";
    }

    // ---------- Player interactions ----------
    collapseBtn.addEventListener("click", ()=>{
      player.classList.toggle("collapsed");
      collapseBtn.textContent = player.classList.contains("collapsed") ? "‚ñ¥" : "‚ñæ";
    });

    shuffleBtn.addEventListener("click", ()=>{
      isShuffle = !isShuffle;
      shuffleBtn.classList.toggle("active", isShuffle);
    });

    repeatBtn.addEventListener("click", ()=>{
      isRepeat = !isRepeat;
      repeatBtn.classList.toggle("active", isRepeat);
    });

    playBtn.addEventListener("click", async ()=>{
      if(!userHasEntered){
        // if they try to play before entering, treat as YES flow
        revealPainting();
      }

      if(!audio.src){
        loadTrack(currentIndex, true);
        return;
      }

      if(audio.paused){
        try{
          await audio.play();
          playBtn.textContent = "‚è∏";
          marquee.classList.remove("paused");
        }catch{
          // browser blocked
          playBtn.textContent = "‚ñ∂";
        }
      }else{
        audio.pause();
        playBtn.textContent = "‚ñ∂";
      }
    });

    nextBtn.addEventListener("click", ()=> nextTrack(true));
    prevBtn.addEventListener("click", ()=> prevTrack());

    // Seek updates
    audio.addEventListener("timeupdate", ()=>{
      if(!isFinite(audio.duration) || audio.duration <= 0) return;
      const p = audio.currentTime / audio.duration;
      seek.value = Math.floor(p * 1000);
      tCur.textContent = padTime(audio.currentTime);
      tDur.textContent = padTime(audio.duration);
    });

    seek.addEventListener("input", ()=>{
      if(!isFinite(audio.duration) || audio.duration <= 0) return;
      const p = Number(seek.value) / 1000;
      audio.currentTime = p * audio.duration;
    });

    audio.addEventListener("ended", ()=>{
      if(isRepeat){
        audio.currentTime = 0;
        audio.play().catch(()=>{});
      }else{
        nextTrack(true);
      }
    });

    // Keep title idle if nothing loaded
    audio.addEventListener("pause", ()=>{
      if(audio.currentTime === 0 && !audio.src){
        setIdleTitle();
      }
    });

    // ---------- Ask buttons ----------
    yesBtn.addEventListener("click", ()=>{
      revealPainting();
      // optional: gently auto-open player after YES
      player.classList.remove("collapsed");
      collapseBtn.textContent = "‚ñæ";
    });

    noBtn.addEventListener("click", ()=>{
      setNoState();
    });

    resetBtn.addEventListener("click", resetAll);

    // ---------- Init ----------
    buildList();
    setIdleTitle();

    // preload first track only as a label (don‚Äôt load audio until user interacts)
    updateListUI();

    // resize rebuild particles for quality
    window.addEventListener("resize", ()=>{
      if(scene.classList.contains("revealed")){
        makeStars(140);
        makeFireflies(28);
        // clouds okay as-is
      }
    });
  </script>
</body>
</html>
